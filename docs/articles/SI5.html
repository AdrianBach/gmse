<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fisheries example integrating FLR • GMSE</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Fisheries example integrating FLR">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GMSE</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.4.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/GMSE.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SI1.html">The Genetic Algorithm of GMSE</a>
    </li>
    <li>
      <a href="../articles/SI2.html">Use of the gmse_apply function</a>
    </li>
    <li>
      <a href="../articles/SI3.html">Example case study in GMSE</a>
    </li>
    <li>
      <a href="../articles/SI4.html">Advanced case study options</a>
    </li>
    <li>
      <a href="../articles/SI5.html">Fisheries example integrating FLR</a>
    </li>
    <li>
      <a href="../articles/SI6.html">Management frequency and extinction risk</a>
    </li>
    <li>
      <a href="../articles/SI7.html">Default GMSE data structures</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../notebook/gmse_notes.html">Lab notebook</a>
</li>
<li>
  <a href="https://github.com/bradduthie/GMSE">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Fisheries example integrating FLR</h1>
            <h3 class="subtitle">GMSE: an R package for generalised management strategy evaluation (Supporting Information 5)</h3>
                        <h4 class="author">A. Bradley Duthie¹³, Jeremy J. Cusack¹, Isabel L. Jones¹, Jeroen Minderman¹, Erlend B. Nilsen², Rocío A. Pozo¹, O. Sarobidy Rakotonarivo¹, Bram Van Moorter², and Nils Bunnefeld¹</h4>
            
            <h4 class="date">[1] Biological and Environmental Sciences, University of Stirling, Stirling, UK [2] Norwegian Institute for Nature Research, Trondheim, Norway [3] <a href="mailto:alexander.duthie@stir.ac.uk">alexander.duthie@stir.ac.uk</a>
</h4>
      
      
      <div class="hidden name"><code>SI5.Rmd</code></div>

    </div>

    
    
<div id="integration-and-simulation-with-fisheries" class="section level1">
<h1 class="hasAnchor">
<a href="#integration-and-simulation-with-fisheries" class="anchor"></a>Integration and simulation with fisheries</h1>
<p>Early development of management strategy evaluation (MSE) models originated in fisheries <span class="citation">(Polacheck et al. <a href="#ref-Polacheck1999">1999</a>; Smith, Sainsbury, and Stevens <a href="#ref-Smith1999">1999</a>; Sainsbury, Punt, and Smith <a href="#ref-Sainsbury2000">2000</a>)</span>. Consequently, fisheries-focused software for MSE has been extensively developed, including R libraries that focus on the management of species of exceptional interest, such as the Atlantic Bluefin Tuna (<em>Thunnus thynnus</em>) <span class="citation">(<a href="https://github.com/ICCAT/abft-mse/tree/master/R_package/ABTMSE">ABFTMSE</a>; Carruthers and Butterworth <a href="#ref-Carruthers2018a">2018</a><a href="#ref-Carruthers2018a">a</a>; Carruthers and Butterworth <a href="#ref-Carruthers2018">2018</a><a href="#ref-Carruthers2018">b</a>)</span>, and Indian Ocean Bigeye (<em>T. obesus</em>) and Yellowfin (<em>T. albacares</em>) Tuna <span class="citation">(<a href="https://github.com/pjumppanen/MSE-IO-BET-YFT">MSE-IO-BET-YFT</a>; Kolody and Jumppanen <a href="#ref-Kolody2016">2016</a>)</span>. The largest of all such libraries is the Fisheries Library in R (<a href="http://www.flr-project.org/">FLR</a>), which includes an extensive collection of tools targeted for fisheries science. The FLR library has been used in over a hundred <a href="http://www.flr-project.org/#publications">publications</a> <span class="citation">(recent publications include Jardim et al. <a href="#ref-Jardim2018">2018</a>; Mackinson et al. <a href="#ref-Mackinson2018">2018</a>; Utizi et al. <a href="#ref-Utizi2018">2018</a>)</span>, and includes <a href="http://www.flr-project.org/doc/An_introduction_to_MSE_using_FLR.html">an MSE framework</a> for evaluating different harvest control rules.</p>
<p>As part of the <a href="https://sti-cs.org/confoobio/">ConFooBio</a> project, a central focus of GMSE is on simulating the management of animal populations of conservation interest, with a particular emphasis on understanding conservation conflict; further development of GMSE is expected to continue with this as a priority, further building upon the decision-making algorithms of managers and users to better understand how conflict arises and can be managed and mitigated. Hence, GMSE is not intended as a substitute for packages such as <a href="http://www.flr-project.org/">FLR</a>, but the integration of these packages with GMSE could make use of GSME’s current and future simulation capabilities, and particularly the <a href="SI1.pdf">genetic algorithm</a>. Such integration might be possible using the <code>gmse_apply</code> function, which allows for <a href="SI2.pdf">custom defined sub-models</a> to be used within the GMSE framework, and with default GMSE sub-models. Hence, GMSE might be especially useful for modelling the management of fisheries under conditions of increasing competing stakeholder demands and conflicts. We do not attempt such an ambitious project here, but instead show how such a project could be developed through integration of <a href="http://www.flr-project.org/">FLR</a> and <code>gmse_apply</code>.</p>
<p>Here we follow a <a href="http://www.flr-project.org/doc/Modelling_stock_recruitment_with_FLSR.html">Modelling Stock-Recruitment with FLSR</a> example, then integrate this example with <code>gmse_apply</code> to explore the behaviour of a number of simulated fishers who are goal-driven to maximise their own harvest and a manager that aims to keep the fish stocks at a predefined target level. The core concept in GMSE is that manager can only incentivise fishers to harvest less or more by varying the cost of fishing (through e.g. taxes) given a set manager budget; please note that the manager cannot force the fisher to follow any policy. Based on the cost of fishing, the fisher can then given their own budget decide whether to invest in fishing or keep the budget. This concepts represents a nartural resource managmeent and conservation conflict, where one party aims to maximise their livelihood (fisher) and the other aims to keep a population at a sustainable level and prevent it from going extinct. Importantly, the manager does not have full control over fishers but can set policies to incentivise sustainable behaviour. We emphasise that this example is provided only as demonstration of how GMSE can potentially be integrated with already developed fisheries models, and is not intended to make recommendations for management in any population.</p>
</div>
<div id="integrating-with-the-fisheries-library-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#integrating-with-the-fisheries-library-in-r" class="anchor"></a>Integrating with the Fisheries Library in R</h1>
<p>The FLR toolset includes <a href="http://www.flr-project.org/#packages">a series of packages</a>, with several <a href="http://www.flr-project.org/doc/index.html">tutorials</a> for using them. For simplicity, we focus on <a href="http://www.flr-project.org/doc/Modelling_stock_recruitment_with_FLSR.html">a model of stock recruitment</a> to be used as the population model in <code>gmse_apply</code>. This population model will use sample data and one of the many available stock-recruitment models available in FLR, and a custom function will be written to return a single value for stock recruitment. Currently, <code>gmse_apply</code> requires that sub-models return subfunction results either as scalar values or data frames that are structured <a href="SI7.pdf">in the same way</a> as GMSE sub-models. But interpretation of scalar values is left up to the user (e.g., population model results could be interpreted as abundance or biomass; manager policy could be interpreted as cost of harvesting or as total allowable catch). For simplicity, the observation (i.e., estimation) model will be the stock reported from the population model with error. The manager and user models, however, will employ the full power of the default GMSE functions to simulate management and user actions. We first show how a custom function can be made that applies the FLR toolset to a population model.</p>
</div>
<div id="modelling-stock-recruitment-for-the-population-model" class="section level1">
<h1 class="hasAnchor">
<a href="#modelling-stock-recruitment-for-the-population-model" class="anchor"></a>Modelling stock-recruitment for the population model</h1>
<p>Here we closely follow <a href="http://www.flr-project.org/doc/Modelling_stock_recruitment_with_FLSR.html">a tutorial from the FLR project</a>. To build the stock-recruitment model, the <code>FLCore</code> package is needed <span class="citation">(Kell et al. <a href="#ref-Kell2007">2007</a>)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">"FLCore"</span>, <span class="dt">repos=</span><span class="st">"http://flr-project.org/R"</span>);</code></pre></div>
<p>To start, we need to read in the <code>FLCore</code> and GMSE libraries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(FLCore);</code></pre></div>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## FLCore (Version 2.6.7, packaged: 2018-04-17 09:12:42 UTC)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GMSE);</code></pre></div>
<p>For a simplified example in GMSE, we will simulate the process of stock recruitment over multiple time steps using an example stock-recruitment model. The stock-recruitment model describes the relationship between stock-recruitment and spawning stock biomass. The sample that we will work from is a recreation of the North Sea Herring (<code>nsher</code>) dataset available in the <code>FLCore</code> package <span class="citation">(Kell et al. <a href="#ref-Kell2007">2007</a>)</span>. This data set includes recruitment and spawning stock biomass data between 1960 and 2004. First, we initialise an empty <code>FLSR</code> object and read in the recreated herring data files from GMSE, which contains recruitment (<code>rec.n</code>) and spawning stock biomass (<code>ssb.n</code>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newFL   &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/FLSR">FLSR</a></span>(); <span class="co"># Initialises the empty FLSR object</span>
<span class="kw">data</span>(nsher_data);  <span class="co"># Called from GMSE library (not from FLCore)</span></code></pre></div>
<p>The recruitment (<code>rec.n</code>) and spawning stock biomass (<code>ssb.n</code>) data need to be in the form of a vector, array, matrix to use them with <code>FLQuant</code>. We will convert <code>rec.n</code> and <code>ssb.n</code> into matrices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rec.m        &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(rec.n);
ssb.m        &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(ssb.n);</code></pre></div>
<p>We can then construct two <code>FLQuant</code> objects, specifying the relevant years and units.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Frec.m       &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/FLQuant">FLQuant</a></span>(rec.m, <span class="dt">dimnames=</span><span class="kw">list</span>(<span class="dt">age=</span><span class="dv">1</span>, <span class="dt">year =</span> <span class="dv">1960</span>:<span class="dv">2004</span>));
Fssb.m       &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/FLQuant">FLQuant</a></span>(ssb.m, <span class="dt">dimnames=</span><span class="kw">list</span>(<span class="dt">age=</span><span class="dv">1</span>, <span class="dt">year =</span> <span class="dv">1960</span>:<span class="dv">2004</span>));
Frec.m@units &lt;-<span class="st"> "10^3"</span>;
Fssb.m@units &lt;-<span class="st"> "t*10^3"</span>;</code></pre></div>
<p>We then place the recruitment and spawning stock biomass data into the <code>FLSR</code> object that we created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/accessors">rec</a></span>(newFL)    &lt;-<span class="st"> </span>Frec.m;
<span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/ssb">ssb</a></span>(newFL)    &lt;-<span class="st"> </span>Fssb.m;
<span class="kw">range</span>(newFL)  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1960</span>, <span class="dv">0</span>, <span class="dv">2004</span>);</code></pre></div>
<p>The <code>FLCore</code> package offers several stock-recruitment models. Here we use a Ricker model of stock recruitment <span class="citation">(Ricker <a href="#ref-Ricker1954">1954</a>)</span>, and insert this model into the <code>FLSR</code> object below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/accessors">model</a></span>(newFL) &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/SRModels">ricker</a></span>();</code></pre></div>
<p>Parameters for the Ricker stock-recruitment model can be estimated with maximum likelihood.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newFL &lt;-<span class="st"> </span><span class="kw">fmle</span>(newFL);</code></pre></div>
<p>Diagnostic plots, identical to those of the <a href="http://www.flr-project.org/doc/Modelling_stock_recruitment_with_FLSR.html">modelling stock-recruitment tutorial</a> for the <code>nsher_ri</code> example, are shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/plot">plot</a></span>(newFL);</code></pre></div>
<div class="figure">
<img src="SI5_files/figure-html/unnamed-chunk-11-1.png" alt="Output of the FLR plot function for an example Ricker model of stock recruitment on North Sea Herring data." width="700"><p class="caption">
Output of the FLR plot function for an example Ricker model of stock recruitment on North Sea Herring data.
</p>
</div>
<p>We now have a working example of a stock-recruitment model, but for our integration with <code>gmse_apply</code>, we will want a function that automates the above to simulate the process of updating the stock-recruitment model. We do this using the custom function created below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">update_SR_model &lt;-<span class="st"> </span>function(rec_m, ssb_m, years){
    Frec_m       &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/FLQuant">FLQuant</a></span>(rec_m, <span class="dt">dimnames=</span><span class="kw">list</span>(<span class="dt">age =</span> <span class="dv">1</span>, <span class="dt">year =</span> years));
    Fssb_m       &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/FLQuant">FLQuant</a></span>(ssb_m, <span class="dt">dimnames=</span><span class="kw">list</span>(<span class="dt">age =</span> <span class="dv">1</span>, <span class="dt">year =</span> years));
    Frec_m@units &lt;-<span class="st"> "10^3"</span>;
    Fssb_m@units &lt;-<span class="st"> "t*10^3"</span>;
    <span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/accessors">rec</a></span>(newFL)   &lt;-<span class="st"> </span>Frec.m;
    <span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/ssb">ssb</a></span>(newFL)   &lt;-<span class="st"> </span>Fssb.m;
    <span class="kw">range</span>(newFL) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, years[<span class="dv">1</span>], <span class="dv">0</span>, years[<span class="kw">length</span>(years)]);
    <span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/accessors">model</a></span>(newFL) &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/SRModels">ricker</a></span>();
    newFL        &lt;-<span class="st"> </span><span class="kw">fmle</span>(newFL);
    <span class="kw">return</span>(newFL);
}</code></pre></div>
<p>The above function will be used within another custom function to predict the next time step of recruitment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predict_recruitment &lt;-<span class="st"> </span>function(rec_m, ssb_m, years, new_ssb){
    newFL &lt;-<span class="st"> </span><span class="kw">update_SR_model</span>(rec_m, ssb_m, years);
    a     &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/accessors">params</a></span>(newFL)[[<span class="dv">1</span>]] <span class="co"># Extract 'a' parameter of the Ricker model</span>
    b     &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLCore/topics/accessors">params</a></span>(newFL)[[<span class="dv">2</span>]] <span class="co"># Extract 'b' parameter of the Ricker model</span>
    rec   &lt;-<span class="st"> </span>a *<span class="st"> </span>new_ssb *<span class="st"> </span><span class="kw">exp</span>(-b *<span class="st"> </span>new_ssb); <span class="co"># Predict the new recruitment</span>
    <span class="kw">return</span>(rec)
}</code></pre></div>
<p>In <code>gmse_apply</code>, we will use the <code>predict_recruitment</code> function above as the resource (i.e., operational) model. The <code>new_ssb</code> reads in the new spawning stock biomass, which will be calculated from the built-in GMSE <code>user</code> model.</p>
</div>
<div id="integrating-predict_recruitment-with-gmse_apply" class="section level1">
<h1 class="hasAnchor">
<a href="#integrating-predict_recruitment-with-gmse_apply" class="anchor"></a>Integrating <code>predict_recruitment</code> with <code>gmse_apply</code>
</h1>
<p>The <a href="http://www.flr-project.org/">FLR project</a> includes libraries that can be used to <a href="http://www.flr-project.org/doc/An_introduction_to_MSE_using_FLR.html">perform a management strategy evaluation</a> (MSE) under fisheries-focused observation, manager, and user models. We will not recreate <a href="http://www.flr-project.org/doc/An_introduction_to_MSE_using_FLR.html">this approach</a>, or integrate any other sub-models into GMSE as was done for the population model above, although such integration of sub-models should be possible using similar techniques. Our goal here is to instead show how the <code>predict_recruitment</code> model created above can be integrated with <code>gmse_apply</code>, which can then make use of the genetic algorithm to predict the fishers’ behaviour.</p>
<p>We will use a custom observation model, which will simply estimate recruitment with some fixed error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">obs_ssb &lt;-<span class="st"> </span>function(resource_vector){
    obs_err &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">100</span>);
    the_obs &lt;-<span class="st"> </span>resource_vector +<span class="st"> </span>obs_err;
    <span class="kw">return</span>(the_obs);
}</code></pre></div>
<p>Hence, we can now feed the data from <code>rec.m</code> and <code>ssb.m</code> through <code>predict_recruitment</code>, which will return a value for new recruitment, and this new value can in turn be fed into <code>obs_ssb</code> to predict recruitment with some error. We also need a new spawning stock biomass <code>new_ssb</code>, which we can just initialise with the biomass from the last year in <code>ssb.m</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ssb_ini &lt;-<span class="st"> </span>ssb.m[<span class="kw">length</span>(ssb.m)];
new_rec &lt;-<span class="st"> </span><span class="kw">predict_recruitment</span>(<span class="dt">rec_m =</span> rec.m, <span class="dt">ssb_m =</span> ssb.m, <span class="dt">years =</span> <span class="dv">1960</span>:<span class="dv">2004</span>,
                               <span class="dt">new_ssb =</span> ssb_ini);
obs_rec &lt;-<span class="st"> </span><span class="kw">obs_ssb</span>(new_rec);</code></pre></div>
<p>An initial run of these models gives values of 3835.21 for <code>new_rec</code> and 3698.36 for <code>obs_rec</code>. We are now ready to use the built-in manager and user sub-models in <code>gmse_apply</code>. We will assume that managers attempt to keep a recruitment of 5000, and that there are 10 independent fishers who attempt to maximise their catch. We assign a user budget of <code>manager_budget = 10000</code>, and all other values are set to GMSE defaults. In the built-in GMSE functions, the manager will use the estimate of recruitment based on <code>obs_rec</code> and use it to set the cost of harvesting (<code>culling</code> in GMSE).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yrspan       &lt;-<span class="st"> </span><span class="dv">1960</span>:<span class="dv">2004</span>;
rec.m        &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(rec.n);
ssb.m        &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(ssb.n);

sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gmse_apply.html">gmse_apply</a></span>(<span class="dt">res_mod =</span> predict_recruitment, <span class="dt">obs_mod =</span> obs_ssb,
                  <span class="dt">rec_m =</span> rec.m, <span class="dt">ssb_m =</span> ssb.m, <span class="dt">years =</span> yrspan, 
                  <span class="dt">new_ssb =</span> ssb_ini, <span class="dt">manage_target =</span> <span class="dv">5000</span>, <span class="dt">stakeholders =</span> <span class="dv">10</span>,
                  <span class="dt">manager_budget =</span> <span class="dv">10000</span>);
<span class="kw">print</span>(sim);</code></pre></div>
<pre><code>## $resource_results
## [1] 3835
## 
## $observation_results
## [1] 3911.502
## 
## $manager_results
##          resource_type scaring culling castration feeding help_offspring
## policy_1             1      NA     455         NA      NA             NA
## 
## $user_results
##         resource_type scaring culling castration feeding help_offspring
## Manager             1      NA       0         NA      NA             NA
## user_1              1      NA       2         NA      NA             NA
## user_2              1      NA       2         NA      NA             NA
## user_3              1      NA       2         NA      NA             NA
## user_4              1      NA       2         NA      NA             NA
## user_5              1      NA       2         NA      NA             NA
## user_6              1      NA       2         NA      NA             NA
## user_7              1      NA       2         NA      NA             NA
## user_8              1      NA       2         NA      NA             NA
## user_9              1      NA       2         NA      NA             NA
## user_10             1      NA       2         NA      NA             NA
##         tend_crops kill_crops
## Manager         NA         NA
## user_1          NA         NA
## user_2          NA         NA
## user_3          NA         NA
## user_4          NA         NA
## user_5          NA         NA
## user_6          NA         NA
## user_7          NA         NA
## user_8          NA         NA
## user_9          NA         NA
## user_10         NA         NA</code></pre>
<p>The resource and observation results above are interpreted in terms of recruitment, while the manager results are interpreted in terms of the cost of harvesting a unit of spawning stock biomass and the user results are interpreted in terms of how much biomass was harvested. Note in the run of <code>gmse_apply</code> that the arguments for our custom resource and observation models (<code>predict_recruitment</code> and <code>obs_ssb</code>, respectively) are read directly in as arguments of <code>gmse_apply</code> itself. The <code>gmse_apply</code> function will figure out which subfunctions custom arguments should go to, then update these arguments as needed over the course of a single run of <code>gmse_apply</code>.</p>
</div>
<div id="simulation-with-gmse_apply-over-multiple-time-steps" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-with-gmse_apply-over-multiple-time-steps" class="anchor"></a>Simulation with <code>gmse_apply</code> over multiple time steps</h1>
<p>We are now ready to loop the <code>gmse_apply</code> function over multiple time steps. To do this, we will update the <code>rec.m</code> and <code>ssb.m</code> matrices after each time step, simulating 20 years into the future. The population model <code>predict_recruitment</code> will use these data to dynamically update parameters of the Ricker model, as might occur in an empirical fishery that is being monitored. We will use the results from the observation model to update recruitment for the new year in <code>rec.m</code>. For simplicity, spawning stock biomass prior to harvest will be randomly sampled from a value in the last 10 years (i.e., from <code>ssb.m</code> between 1994 and 2004), but more realistic models could relate this spawning stock biomass to recruitment and environmental variables from a previous year; spawning stock biomass will be decreased after harvest based on user actions. The GMSE initialisation and simulation is below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This code initialises the simulation -----------------------------------------</span>
yrspan       &lt;-<span class="st"> </span><span class="dv">1960</span>:<span class="dv">2004</span>;
rec.m        &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(rec.n);
ssb.m        &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(ssb.n);
ssb_ini      &lt;-<span class="st"> </span>ssb.m[<span class="kw">length</span>(ssb.m)];
sim_old      &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gmse_apply.html">gmse_apply</a></span>(<span class="dt">res_mod =</span> predict_recruitment, <span class="dt">obs_mod =</span> obs_ssb,
                           <span class="dt">rec_m =</span> rec.m, <span class="dt">ssb_m =</span> ssb.m, <span class="dt">years =</span> yrspan, 
                           <span class="dt">new_ssb =</span> ssb_ini, <span class="dt">manage_target =</span> <span class="dv">3500</span>, 
                           <span class="dt">stakeholders =</span> <span class="dv">10</span>, <span class="dt">manager_budget =</span> <span class="dv">10000</span>, 
                           <span class="dt">get_res =</span> <span class="st">"Full"</span>);
<span class="co"># The code below simulates 20 time steps ---------------------------------------</span>
sim_sum  &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">20</span>, <span class="dt">ncol =</span> <span class="dv">6</span>); <span class="co"># Hold results here</span>
for(time_step in <span class="dv">1</span>:<span class="dv">20</span>){
    <span class="co"># Update the relevant parameter values as necessary -----------------------</span>
    rand_ssb        &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> ssb.m[<span class="dv">35</span>:<span class="dv">45</span>], <span class="dt">size =</span> <span class="dv">1</span>);
    harvest         &lt;-<span class="st"> </span><span class="kw">sum</span>(sim_old$basic_output$user_results[,<span class="dv">3</span>]);
    new_rec_m       &lt;-<span class="st"> </span><span class="kw">c</span>(sim_old$rec_m, sim_old$observation_vector);
    new_ssb_m       &lt;-<span class="st"> </span><span class="kw">c</span>(sim_old$ssb_m, rand_ssb -<span class="st"> </span>harvest);
    sim_old$rec_m   &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> new_rec_m, <span class="dt">nrow =</span> <span class="dv">1</span>);
    sim_old$ssb_m   &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> new_ssb_m, <span class="dt">nrow =</span> <span class="dv">1</span>);
    sim_old$years   &lt;-<span class="st"> </span><span class="kw">c</span>(sim_old$years, time_step +<span class="st"> </span><span class="dv">2004</span>);
    sim_old$new_ssb &lt;-<span class="st"> </span>sim_old$ssb_m[<span class="kw">length</span>(sim_old$ssb_m)];
    <span class="co"># Run a new simulation in the loop: custom functions are always specified -</span>
    sim_new  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gmse_apply.html">gmse_apply</a></span>(<span class="dt">get_res =</span> <span class="st">"Full"</span>, <span class="dt">old_list =</span> sim_old,
                           <span class="dt">res_mod =</span> predict_recruitment, <span class="dt">obs_mod =</span> obs_ssb);
    <span class="co"># Record the results in sim_sum -------------------------------------------</span>
    sim_sum[time_step, <span class="dv">1</span>] &lt;-<span class="st"> </span>time_step +<span class="st"> </span><span class="dv">2004</span>;
    sim_sum[time_step, <span class="dv">2</span>] &lt;-<span class="st"> </span>sim_new$basic_output$resource_results[<span class="dv">1</span>];
    sim_sum[time_step, <span class="dv">3</span>] &lt;-<span class="st"> </span>sim_new$basic_output$observation_results[<span class="dv">1</span>];
    sim_sum[time_step, <span class="dv">4</span>] &lt;-<span class="st"> </span>sim_new$basic_output$manager_results[<span class="dv">3</span>];
    sim_sum[time_step, <span class="dv">5</span>] &lt;-<span class="st"> </span>harvest;
    sim_sum[time_step, <span class="dv">6</span>] &lt;-<span class="st"> </span>sim_new$new_ssb;
    <span class="co"># Redefine the old list --------------------------------------------------</span>
    sim_old               &lt;-<span class="st"> </span>sim_new;
}
<span class="kw">colnames</span>(sim_sum) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Year"</span>, <span class="st">"Recruitment"</span>, <span class="st">"Recruit_estim"</span>, <span class="st">"Harvest_cost"</span>, 
                         <span class="st">"Harvested"</span>, <span class="st">"SSB"</span>);
<span class="kw">print</span>(sim_sum);</code></pre></div>
<pre><code>##       Year Recruitment Recruit_estim Harvest_cost Harvested      SSB
##  [1,] 2005        2399      2469.277          507        20  25.5913
##  [2,] 2006        4082      4157.523          580        10  60.6639
##  [3,] 2007        3988      3974.308          502        10 175.5799
##  [4,] 2008        4629      4682.194          647        10 115.2627
##  [5,] 2009        4339      4401.497          594        10  71.3340
##  [6,] 2010        4082      4032.413          502        10  60.6639
##  [7,] 2011        4082      4150.305          636        10  60.6639
##  [8,] 2012        4387      4499.406          564        10 145.9025
##  [9,] 2013        2994      3038.318          605        10  34.8673
## [10,] 2014        3303      3448.388          500        10  40.6133
## [11,] 2015        4336      4507.365          583        20 150.1926
## [12,] 2016        4328      4250.471          547        10  70.7603
## [13,] 2017        3303      3305.817          621        10  40.6133
## [14,] 2018        3988      4052.567          501        10 175.5799
## [15,] 2019        4208      4330.178          536        10 160.1926
## [16,] 2020        3988      4001.033          523        10 175.5799
## [17,] 2021        4387      4306.056          492        10 145.9025
## [18,] 2022        4085      3981.186          492        20  60.7603
## [19,] 2023        4491      4621.019          474        20 135.9025
## [20,] 2024        4085      3891.443          474        20  60.7603</code></pre>
<p>The above output from <code>sim_sum</code> reports the recruitment (resource or operational model), recruitment estimate (observation error model), management set harvest cost (harvest control model), user harvested numbers (implementation model) and spawning stock biomass (SSB) simulation results. This example simulation demonstrates the ability of GMSE to integrate with fisheries libraries such as <a href="http://www.flr-project.org/">FLR</a> through <code>gmse_apply</code>. In addition to being a useful wrapping function for MSE sub-models, <code>gmse_apply</code> can therefore be used to take advantage of the genetic algorithm in the GMSE default manager and user models. This flexibility will be retained in future versions of <code>gmse_apply</code>, allowing custom resource and observation models that are built for specific systems to be integrated with an increasingly complex genetic algorithm simulating various aspects of human decision-making.</p>
</div>
<div id="conclusions" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusions" class="anchor"></a>Conclusions</h1>
<p>GMSE is a general, flexible, tool for simulating the management of resources under situations of uncertainty and conflict. Management Strategy Evaluation <span class="citation">(Bunnefeld, Hoshino, and Milner-Gulland <a href="#ref-Bunnefeld2011">2011</a>; Punt et al. <a href="#ref-Punt2016">2016</a>)</span>, the framework upon which GMSE is based, had its origin in fisheries management <span class="citation">(Polacheck et al. <a href="#ref-Polacheck1999">1999</a>; Smith, Sainsbury, and Stevens <a href="#ref-Smith1999">1999</a>; Sainsbury, Punt, and Smith <a href="#ref-Sainsbury2000">2000</a>)</span>, and here we showed one example of how GMSE could be integrated with the core package of the <a href="http://www.flr-project.org/">Fisheries Library in R</a>.</p>
<p>Future versions of GMSE will continue to be open-source and developed to avoid unecessary dependencies (GMSE v.0.4.0.3 requires only base R). Key goals including (1) providing highly general and useful default <code>resource</code>, <code>observation</code>, <code>manager</code>, and <code>user</code> sub-models for a variety of MSE modelling tasks, (2) keeping these sub-models highly modular so that they can be developed in isolation given standardised data structures, and (3) allowing these modular sub-models to be integrated with custom defined sub-models as flexibly as possible using <code>gmse_apply</code>. Contributions in line with these goals, and suggestions for new features, can be made on <a href="https://github.com/bradduthie/gmse">GitHub</a>.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Bunnefeld2011">
<p>Bunnefeld, Nils, Eriko Hoshino, and Eleanor J Milner-Gulland. 2011. “Management strategy evaluation: A powerful tool for conservation?” <em>Trends in Ecology and Evolution</em> 26 (9): 441–47. doi:<a href="https://doi.org/10.1016/j.tree.2011.05.003">10.1016/j.tree.2011.05.003</a>.</p>
</div>
<div id="ref-Carruthers2018a">
<p>Carruthers, T, and D Butterworth. 2018a. “ABT-MSE : An R package for atlantic bluefin tuna management strategy evaluation.” <em>Collective Volume of Scientific Papers ICCAT</em> 74 (6): 3553–9.</p>
</div>
<div id="ref-Carruthers2018">
<p>———. 2018b. “Performance of example management procedures for atlantic bluefin tuna.” <em>Collective Volume of Scientific Papers ICCAT</em> 73 (6): 3542–52.</p>
</div>
<div id="ref-Jardim2018">
<p>Jardim, Ernesto, Margit Eero, Alexandra Silva, Clara Ulrich, Lionel Pawlowski, Isabel Riveiro, Steven J Holmes, et al. 2018. “Testing spatial heterogeneity with stock assessment models.” <em>PLoS One</em> 13: e0190891. doi:<a href="https://doi.org/10.1371/journal.pone.0190791">10.1371/journal.pone.0190791</a>.</p>
</div>
<div id="ref-Kell2007">
<p>Kell, L T, I Mosqueira, P Grosjean, Jean-Marc Fromentin, D Garcia, R Hillary, E Jardim, et al. 2007. “FLR: an open-source framework for the evaluation and development of management strategies.” <em>ICES Journal of Marine Science</em> 64 (4): 640–46. <a href="https://mail.google.com/mail/u/0/?ui=2%7B%5C&amp;%7Dpli=1%7B%5C%%7D5Cnpapers2://publication/doi/10.1093/icesjms/fsm012" class="uri">https://mail.google.com/mail/u/0/?ui=2{\&amp;}pli=1{\%}5Cnpapers2://publication/doi/10.1093/icesjms/fsm012</a>.</p>
</div>
<div id="ref-Kolody2016">
<p>Kolody, Dale, and Paavo Jumppanen. 2016. “IOTC Yellowfin and Bigeye Tuna Management Strategy Evaluation: Phase 1 Technical Support Project Final Report.” June. CSIRO: Oceans &amp; Atmosphere.</p>
</div>
<div id="ref-Mackinson2018">
<p>Mackinson, Steven, Mark Platts, Clement Garcia, and Christopher Lynam. 2018. “Evaluating the fishery and ecological consequences of the proposed North Sea multi-annual plan.” <em>PLoS One</em> 13: e0190015. doi:<a href="https://doi.org/10.1371/journal.pone.0190015">10.1371/journal.pone.0190015</a>.</p>
</div>
<div id="ref-Polacheck1999">
<p>Polacheck, T, N L Klaer, C Millar, and A L Preece. 1999. “An initial evalutaion of management strategies for the southern bluefin tuna fishery.” <em>ICES Journal of Marine Science</em> 56 (6): 811–26. doi:<a href="https://doi.org/10.1006/jmsc.1999.0554">10.1006/jmsc.1999.0554</a>.</p>
</div>
<div id="ref-Punt2016">
<p>Punt, André E, Doug S Butterworth, Carryn L de Moor, José A A De Oliveira, and Malcolm Haddon. 2016. “Management strategy evaluation: Best practices.” <em>Fish and Fisheries</em> 17 (2): 303–34. doi:<a href="https://doi.org/10.1111/faf.12104">10.1111/faf.12104</a>.</p>
</div>
<div id="ref-Ricker1954">
<p>Ricker, W E. 1954. “Stock and recruitment.” <em>Journal of the Fisheries Board of Canada</em> 11 (5): 559–623.</p>
</div>
<div id="ref-Sainsbury2000">
<p>Sainsbury, Keith J, André E Punt, and Anthony DM Smith. 2000. “Design of operational management strategies for achieving fishery ecosystem objectives.” <em>ICES Journal of Marine Science</em> 57 (3): 731–41. doi:<a href="https://doi.org/10.1006/jmsc.2000.0737">10.1006/jmsc.2000.0737</a>.</p>
</div>
<div id="ref-Smith1999">
<p>Smith, A D M, K J Sainsbury, and R A Stevens. 1999. “Implementing effective fisheries-management systems – management strategy evaluation and the Australian partnership approach.” <em>ICES Journal of Marine Science</em> 56 (6): 967–79. doi:<a href="https://doi.org/10.1006/jmsc.1999.0540">10.1006/jmsc.1999.0540</a>.</p>
</div>
<div id="ref-Utizi2018">
<p>Utizi, Kizzi, Emilio Notti, Antonello Sala, Alessandro Buzzi, Ilaria Rodella, Umberto Simeoni, and Corinne Corbau. 2018. “Impact assessment of EMFF measures on Good Environmental Status (GES) as defined by Italy.” <em>Marine Policy</em> 88. Elsevier Ltd: 248–60. doi:<a href="https://doi.org/10.1016/j.marpol.2017.12.003">10.1016/j.marpol.2017.12.003</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#integration-and-simulation-with-fisheries">Integration and simulation with fisheries</a></li>
      <li><a href="#integrating-with-the-fisheries-library-in-r">Integrating with the Fisheries Library in R</a></li>
      <li><a href="#modelling-stock-recruitment-for-the-population-model">Modelling stock-recruitment for the population model</a></li>
      <li><a href="#integrating-predict_recruitment-with-gmse_apply">Integrating <code>predict_recruitment</code> with <code>gmse_apply</code></a></li>
      <li><a href="#simulation-with-gmse_apply-over-multiple-time-steps">Simulation with <code>gmse_apply</code> over multiple time steps</a></li>
      <li><a href="#conclusions">Conclusions</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by A. Bradley Duthie, Nils Bunnefeld.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
